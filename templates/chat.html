{% extends 'base.html' %}
{% block main %}
<div class="max-w-2xl mx-auto pb-10">
  <div class="bg-base-100/90 backdrop-blur-sm sticky top-0 z-20">
    <div class="py-1 px-2 flex justify-between items-center">
      <div class="flex items-center gap-0 sm:gap-1 max-sm:truncate">
        <a href="/" class="btn btn-ghost btn-circle max-sm:btn-sm">
          <img src="/static/img/arrow_back.svg" alt="Back">
        </a>
        <a href="/3/{{ name }}" class="link link-hover text-[0.8125rem] sm:text-sm max-sm:truncate">{{ name }}</a>
      </div>
      <div class="flex items-center gap-1">
        <button class="btn px-2.5 sm:px-7" onclick="encrypt_modal.showModal()">Encrypt</button>
        <button class="btn px-2.5 sm:px-7" onclick="decrypt_modal.showModal()">Decrypt</button>
      </div>
    </div>
  </div>
  <div class="pt-2 px-2">
    {% for sender, message, type in messages %}
    <div class="chat {% if sender == 1 %}chat-end{% else %}chat-start{% endif %}{% if type == 'e' %} break-all{% endif %}">
      <div class="chat-bubble{% if sender == 1 %} chat-bubble-secondary{% endif %}">{{ message }}</div>
    </div>
    {% endfor %}
  </div>
</div>
<dialog id="encrypt_modal" class="modal"{% if encrypted_output %} open{% endif %}>
  <div class="modal-box max-w-md p-5">
    <h3 class="font-semibold">Encrypt</h3>
    <form method="post" id="encrypt-form">
      <fieldset class="fieldset pt-4 pb-0">
        <textarea name="message" class="textarea" placeholder="Message" spellcheck="false" required></textarea>
        <input type="password" name="password" class="input mt-2" value="{{ password }}" placeholder="Password" required>
        <label class="label">
          <input type="checkbox" name="return_password_1" class="checkbox"{% if password %} checked{% endif %}>
          Return password
        </label>
        <button type="submit" class="btn btn-primary my-2">
          <span>Encrypt</span>
          <span class="loading loading-spinner hidden"></span>
        </button>
        <textarea id="output-1" class="textarea break-all" disabled>{{ encrypted_output }}</textarea>
        <button type="button" id="copy-1" class="btn mt-2">Copy to clipboard</button>
      </fieldset>
    </form>
  </div>
  <form method="dialog" class="modal-backdrop"><button></button></form>
</dialog>
<dialog id="decrypt_modal" class="modal"{% if decrypted_output %} open{% endif %}>
  <div class="modal-box max-w-md p-5">
    <h3 class="font-semibold">Decrypt</h3>
    <form method="post" id="decrypt-form">
      <fieldset class="fieldset pt-4 pb-0">
        <textarea id="encrypted-message" name="encrypted_message" class="textarea" placeholder="Message (optional)" spellcheck="false"></textarea>
        <input type="password" name="password" class="input mt-2" value="{{ password }}" placeholder="Password" required>
        <label class="label">
          <input type="checkbox" name="return_password_2" class="checkbox"{% if password %} checked{% endif %}>
          Return password
        </label>
        <button type="submit" class="btn btn-primary my-2">
          <span>Decrypt</span>
          <span class="loading loading-spinner hidden"></span>
        </button>
        <textarea id="output-2" class="textarea break-all" disabled>{{ decrypted_output }}</textarea>
        <button type="button" id="copy-2" class="btn mt-2">Copy to clipboard</button>
      </fieldset>
    </form>
  </div>
  <form method="dialog" class="modal-backdrop"><button></button></form>
</dialog>
{% endblock %}