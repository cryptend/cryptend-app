{% extends 'base.html' %}
{% block main %}
<div class="max-w-xl mx-auto">
  <div class="text-center text-sm pb-2">
    <a href="/3/{{ name }}" class="link link-hover">{{ name }}</a>
  </div>
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 pb-2">
    <button class="btn" onclick="decrypt_chat_modal.showModal()">Decrypt chat</button>
    <button class="btn" onclick="encrypt_message_modal.showModal()">Encrypt message</button>
    <button class="btn" onclick="decrypt_message_modal.showModal()">Decrypt message</button>
  </div>
  {% for sender, message, type in messages %}
  {% if sender == 1 %}
  <div class="chat chat-end{% if type == 'e' %} break-all{% endif %}">
    <div class="chat-bubble bg-primary/25">{{ message }}</div>
  </div>
  {% elif sender == 2 %}
  <div class="chat chat-start{% if type == 'e' %} break-all{% endif %}">
    <div class="chat-bubble">{{ message }}</div>
  </div>
  {% endif %}
  {% endfor %}
</div>
<dialog id="decrypt_chat_modal" class="modal">
  <div class="modal-box">
    <form method="post" id="decrypt-chat-form">
      <fieldset class="fieldset">
        <legend class="fieldset-legend">Decrypt chat</legend>
        <div class="label">Password</div>
        <input type="password" name="password" class="input" required>
        <button type="submit" class="btn btn-primary mt-2">
          <span>Decrypt chat</span>
          <span class="loading loading-spinner hidden"></span>
        </button>
      </fieldset>
    </form>
  </div>
  <form method="dialog" class="modal-backdrop"><button></button></form>
</dialog>
<dialog id="encrypt_message_modal" class="modal"{% if encrypted_output %} open{% endif %}>
  <div class="modal-box">
    <form method="post" id="encrypt-message-form">
      <fieldset class="fieldset">
        <legend class="fieldset-legend">Encrypt message</legend>
        <div class="label">Message</div>
        <textarea name="message" class="textarea" spellcheck="false" required>{{ message }}</textarea>
        <div class="label">Password</div>
        <input type="password" name="password" class="input" required>
        <button type="submit" class="btn btn-primary my-2">
          <span>Encrypt message</span>
          <span class="loading loading-spinner hidden"></span>
        </button>
        <div class="label">Encrypted message</div>
        <textarea id="output-1" class="textarea break-all" disabled>{{ encrypted_output }}</textarea>
        <button type="button" id="copy-1" class="btn mt-2">Copy to clipboard</button>
      </fieldset>
    </form>
  </div>
  <form method="dialog" class="modal-backdrop"><button></button></form>
</dialog>
<dialog id="decrypt_message_modal" class="modal"{% if decrypted_output %} open{% endif %}>
  <div class="modal-box">
    <form method="post" id="decrypt-message-form">
      <fieldset class="fieldset">
        <legend class="fieldset-legend">Decrypt message</legend>
        <div class="label">Encrypted message</div>
        <textarea name="encrypted_message" class="textarea" spellcheck="false" required>{{ encrypted_message }}</textarea>
        <div class="label">Password</div>
        <input type="password" name="password" class="input" required>
        <button type="submit" class="btn btn-primary my-2">
          <span>Decrypt message</span>
          <span class="loading loading-spinner hidden"></span>
        </button>
        <div class="label">Decrypted message</div>
        <textarea id="output-2" class="textarea break-all" disabled>{{ decrypted_output }}</textarea>
        <button type="button" id="copy-2" class="btn mt-2">Copy to clipboard</button>
      </fieldset>
    </form>
  </div>
  <form method="dialog" class="modal-backdrop"><button></button></form>
</dialog>
{% endblock %}